{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,sans-serif}

:root{
    --sidebar:#2d8a63;
    --bg:#e9f0eb;
    --card:#fff;
    --text-muted:#7a7a7a;
    --primary-color: #0f334bff;

}

body{
    display:flex;
    background:var(--bg);
    min-height:100vh;
}

/* ---------- SIDEBAR ---------- */
.sidebar{
    width:260px;
    background:var(--sidebar);
    color:#fff;
    position:fixed;
    height:100vh;
    display:flex;
    flex-direction:column;
}

.sidebar-brand{
    padding:30px;
    font-size:22px;
    font-weight:600;
}

.nav-menu{list-style:none;flex:1}

.nav-item a{
    display:flex;
    align-items:center;
    gap:15px;
    padding:15px 30px;
    color:rgba(255,255,255,.85);
    text-decoration:none;
    cursor:pointer;
}

.nav-item.active a{
    background:var(--bg);
    color:var(--sidebar);
    border-radius:40px 0 0 40px;
    margin-left:20px;
    font-weight:600;
}

.sidebar-footer{
    padding:20px;
    text-align:center;
}

/* ---------- MAIN CONTENT ---------- */
.main-content{
    margin-left:260px;
    padding:40px;
    width:100%;
}

.top-bar{
    display:flex;
    justify-content:space-between;
    margin-bottom:30px;
}

.user-info{
    display:flex;
    align-items:center;
    gap:10px;
}

.user-info img{
    width:36px;
    height:36px;
    border-radius:50%;
}

/* ---------- SECTIONS ---------- */
.content-section{display:none;animation:fade .3s}
.content-section.active{display:block}

@keyframes fade{
    from{opacity:0;transform:translateY(6px)}
    to{opacity:1}
}

/* ---------- DASHBOARD CARDS ---------- */
.stats-grid{
    display:grid;
    grid-template-columns:repeat(3,1fr);
    gap:25px;
    margin-bottom:30px;
}

.stat-card{
    background:var(--card);
    padding:25px;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,.05);
    position:relative;
}

.stat-card h4{font-size:14px;color:var(--text-muted)}
.stat-card .value{font-size:28px;font-weight:700}
.icon-circle{
    position:absolute;
    top:20px;
    right:20px;
    width:36px;height:36px;
    background:#eef6f2;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:var(--sidebar);
}
.btn {
    padding: 10px 20px;
    border-radius: 5px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s;
    border: none;
    cursor: pointer;
    display: inline-block;
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.filters {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.filters form {
    display: flex;
    gap: 15px;
    align-items: center;
}

.filters input {
    flex: 1;
    padding: 10px 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 14px;
}
/* ---------- TABLE ---------- */
.table-box{
    background:#fff;
    padding:25px;
    border-radius:20px;
    box-shadow:0 10px 25px rgba(0,0,0,.05);
}

table{width:100%;border-collapse:collapse}
th,td{padding:14px;text-align:left;border-bottom:1px solid #eee}
th{color:#666;font-size:13px}
</style>
</head>

<body>

<!-- ================= SIDEBAR ================= -->
<div class="sidebar">
    <div class="sidebar-brand">M - SoftTech</div>

    <ul class="nav-menu">
        <li class="nav-item active" onclick="showSection('dashboard',this)">
            <a><i class="fas fa-th-large"></i> Dashboard</a>
        </li>
        <li class="nav-item" onclick="showSection('users',this)">
            <a><i class="fas fa-user-friends"></i> User Control</a>
        </li>
        <li class="nav-item" onclick="showSection('access',this)">
            <a><i class="fas fa-key"></i> Access Request</a>
        </li>
        <li class="nav-item">
            <a href="{% url 'logout' %}">
                <i class="fas fa-power-off"></i> Quit
            </a>
        </li>
    </ul>

    <div class="sidebar-footer">
        <i class="fas fa-headset"></i>
        <p style="font-size:11px">24/7 Support</p>
    </div>
</div>

<!-- ================= MAIN CONTENT ================= -->
<div class="main-content">

    <div class="top-bar">
        <h3>Admin Panel</h3>
        <div class="user-info">
            <img src="https://ui-avatars.com/api/?name={{ request.user.username }}&background=2d8a63&color=fff">
            <strong>{{ request.user.username }}</strong>
        </div>
    </div>

    <!-- ===== DASHBOARD ===== -->
    <div id="dashboard" class="content-section active">
        <div class="stats-grid">
            <div class="stat-card">
                <h4>Total Revenue</h4>
                <div class="value">â‚¹{{ total_revenue }}</div>
                <div class="icon-circle"><i class="fas fa-chart-line"></i></div>
            </div>
            <div class="stat-card">
                <h4>Total Orders</h4>
                <div class="value">{{ total_orders }}</div>
                <div class="icon-circle"><i class="fas fa-shopping-cart"></i></div>
            </div>
            <div class="stat-card">
                <h4>Total Users</h4>
                <div class="value">{{ total_users }}</div>
                <div class="icon-circle"><i class="fas fa-users"></i></div>
            </div>
        </div>
    </div>

    <!-- ===== USER CONTROL ===== -->
    <div id="users" class="content-section">
        <div class="filters">
            <form id="userSearchForm">
                <input type="text"
                    id="userSearchInput"
                    placeholder="Search by username, email, or name...">

                <button type="submit" class="btn" style="background: var(--sidebar); color: white;">
                    <i class="fas fa-search"></i> Search
                </button>

                <button type="button"
                        class="btn btn-secondary"
                        onclick="loadAllUsers()">
                    <i class="fas fa-redo"></i> Reset
                </button>
            </form>
        </div>

        <div class="table-box">
            <h3 style="margin-bottom:15px">Manage Users</h3>

            <!-- THIS PART WILL BE UPDATED DYNAMICALLY -->
            <div id="usersTableWrapper">
                {% include "admin/partials/users_table.html" %}
            </div>
        </div>
    </div>

        <!-- ===== ACCESS REQUEST ===== -->
        <div id="access" class="content-section">
            <div class="table-box">
                <h3>Access Requests</h3>
                <p style="color:#777;margin-top:10px">
                    Access request content goes here.
                </p>
            </div>
        </div>

    </div>

<!-- ================= SCRIPT ================= -->
<script>
function showSection(id,el){
    document.querySelectorAll('.content-section')
        .forEach(s=>s.classList.remove('active'));
    document.getElementById(id).classList.add('active');

    document.querySelectorAll('.nav-item')
        .forEach(n=>n.classList.remove('active'));
    el.classList.add('active');
}

const form = document.getElementById("userSearchForm");
const input = document.getElementById("userSearchInput");
const tableWrapper = document.getElementById("usersTableWrapper");

form.addEventListener("submit", function (e) {
    e.preventDefault();

    fetch(`/dashboard/users/search/?q=${encodeURIComponent(input.value)}`)
        .then(response => response.text())
        .then(html => {
            tableWrapper.innerHTML = html;
        })
        .catch(err => console.error(err));
});

function loadAllUsers() {
    input.value = "";
    fetch(`/dashboard/users/search/?q=`)
        .then(response => response.text())
        .then(html => {
            tableWrapper.innerHTML = html;
        });
}
</script>
</body>
</html>
